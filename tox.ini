[tox]
envlist=python39-test,lint
toxworkdir={env:TOXWORKDIR:.tox}
ignore_base_python_conflict=true

[testenv]
basepython = {env:PYTHON:python3.9}
setenv = LANG = en_US.UTF-8
deps = -r requirements/test.txt
changedir = ./hwbench
commands =
    coverage erase
    coverage run -m pytest -vvv --junitxml=junit-{envname}.xml --ignore={toxworkdir}
    coverage report --omit={toxworkdir}/*
    coverage html --directory=coverage-{envname} --omit={toxworkdir}/*

[testenv:bundle]
changedir = ./
commands =
    # Creates a source archive in sdist/.
    {envpython} setup.py sdist --dist-dir=sdist --format=gztar

# Linter environment
[testenv:lint]
changedir = ./
commands =
    ruff check hwbench/ setup.py
    black --check hwbench/ setup.py

deps = -r requirements/test.txt
